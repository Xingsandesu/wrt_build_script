# Do not edit, changes to this file will be lost on upgrades
# /etc/sysctl.conf can be used to customize sysctl settings

kernel.panic=3
kernel.core_pattern=/tmp/%e.%t.%p.%s.core
fs.suid_dumpable=2

fs.protected_hardlinks=1
fs.protected_symlinks=1

net.core.bpf_jit_enable=1
net.core.bpf_jit_kallsyms=1

net.ipv4.conf.default.arp_ignore=1
net.ipv4.conf.all.arp_ignore=1
net.ipv4.ip_forward=1
net.ipv4.icmp_echo_ignore_broadcasts=1
net.ipv4.icmp_ignore_bogus_error_responses=1
net.ipv4.igmp_max_memberships=100
net.ipv4.tcp_fin_timeout=30
net.ipv4.tcp_keepalive_time=120
net.ipv4.tcp_syncookies=1
net.ipv4.tcp_timestamps=1
net.ipv4.tcp_sack=1
net.ipv4.tcp_dsack=1
net.ipv4.tcp_max_syn_backlog=8192

net.ipv6.conf.default.forwarding=1
net.ipv6.conf.all.forwarding=1

# 禁用 TCP 指标保存，避免旧连接影响新连接性能
net.ipv4.tcp_no_metrics_save=1
# 禁用显式拥塞通知 (ECN)，避免兼容性问题
net.ipv4.tcp_ecn=0
# 禁用 Forward RTO 恢复，减少不必要的重传
net.ipv4.tcp_frto=0
# 禁用 MTU 探测，避免在稳定网络中不必要的探测
net.ipv4.tcp_mtu_probing=0
# 禁用 RFC1337 TIME_WAIT 状态保护，减少资源占用
net.ipv4.tcp_rfc1337=0
# 启用 Forward Acknowledgment (FACK)，提高 TCP 效率
net.ipv4.tcp_fack=1
# 启用 TCP 窗口缩放，支持更大窗口提高吞吐量
net.ipv4.tcp_window_scaling=1
# 设置高级窗口缩放因子
net.ipv4.tcp_adv_win_scale=1
# 启用接收缓冲区适度调整
net.ipv4.tcp_moderate_rcvbuf=1
# 设置 TCP 接收缓冲区大小 (最小 默认 最大)
net.ipv4.tcp_rmem=4096 87380 33554432
# 设置 TCP 发送缓冲区大小 (最小 默认 最大)
net.ipv4.tcp_wmem=4096 16384 16777216
# 允许路由本地网络流量
net.ipv4.conf.all.route_localnet=1
# 启用所有接口的 IP 转发
net.ipv4.conf.all.forwarding=1
# 启用默认接口的 IP 转发
net.ipv4.conf.default.forwarding=1
# 设置默认队列规则为 fq (Fair Queueing)，提高公平性和性能
net.core.default_qdisc=fq
# 设置 TCP 拥塞控制算法为 BBR，提高网络拥塞控制效率
net.ipv4.tcp_congestion_control=bbr
